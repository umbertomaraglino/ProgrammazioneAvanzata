"use strict";var J=Object.defineProperty;var U=(s,t,o)=>t in s?J(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o;var l=(s,t,o)=>(U(s,typeof t!="symbol"?t+"":t,o),o);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("./engine-74273f00.cjs");function V(s,t){return s.origin===t.origin&&s.destination===t.destination&&s.captures===t.captures}function Y(s){const t=Math.floor(Math.sqrt(s.length)),o="-".repeat(1+t*4);let n=`${o}
`;for(const[e,a]of s.entries()){if(e%t===0&&(n+="|"),a.piece){let c=a.piece.player===u.DraughtsPlayer.LIGHT?"x":"o";c=a.piece.king?c.toUpperCase():c,n+=` ${c} |`}else n+="   |";e%t===t-1&&(n+=` 
${o}
`)}return n}class q{constructor(t,o,n){l(this,"engine");l(this,"history");l(this,"_board");l(this,"_moves");l(this,"adapter");this.engine=t,this.history=o,this.adapter=n}get status(){return this.engine.status}get player(){return this.engine.data.player}get board(){return this._board??(this._board=this.adapter.toBoard1D(this.engine.data.board))}get moves(){return this._moves??(this._moves=this.engine.moves.map(t=>this.adapter.toMove1D(t)))}isValidMove(t){const o=this.adapter.toEngineMove(t);return this.engine.isValidMove(o)}move(t){if(!this.isValidMove(t))throw new Error(`invalid move: ${JSON.stringify(t)}`);this.history.boards.push(this.board),this.history.moves.push(t);const o=this.adapter.toEngineMove(t);this.engine.move(o),this._board=void 0,this._moves=void 0}asciiBoard(){return Y(this.board)}}const D=32,r=[];r[0]=1;for(let s=1;s<D;s++)r[s]=r[s-1]*2;const v=4294967295;function d(s,t){const o=t%D;return(s>>>o|s<<D-o&v)>>>0}function h(s,t){const o=t%D;return(s<<o&v|s>>>D-o)>>>0}function y(s){const t=[];for(let o=1;s;o<<=1)s&o&&(t.push(o>>>0),s^=o);return t}function g(s){return s=s-(s>>>1&1431655765),s=(s&858993459)+(s>>>2&858993459),s=(s+(s>>>4)&252645135)*16843009>>>24,s}const j=r[11]|r[5]|r[31]|r[25]|r[10]|r[4]|r[30]|r[24]|r[3]|r[29]|r[23]|r[17]|r[2]|r[28]|r[22]|r[16]|r[27]|r[21]|r[15]|r[9]|r[26]|r[20]|r[14]|r[8]|r[9]|r[3]|r[7]|r[1]|r[18]|r[12]|r[6]|r[0],A=r[18]|r[12]|r[6]|r[0],N=r[19]|r[13]|r[7]|r[1],L=r[26]|r[20]|r[14]|r[8],K=r[3]|r[29]|r[23]|r[17],k=r[10]|r[4]|r[30]|r[24],T=r[11]|r[5]|r[31]|r[25],m=r[18]|r[26]|r[2]|r[10],F=r[1]|r[9]|r[17]|r[25],z=~(T|m),Q=~(T|F),X=~(A|m),Z=~(A|F),$=A|N|L,tt=K|k|T,st=r[21]|r[28]|r[22],ot=r[29]|r[22]|r[21]|r[14],i={BOARD:j,RANK_0:A,RANK_1:N,RANK_2:L,RANK_5:K,RANK_6:k,RANK_7:T,FILE_0:m,FILE_7:F,FORWARD_LEFT:z,FORWARD_RIGHT:Q,BACKWARD_LEFT:X,BACKWARD_RIGHT:Z,LIGHT_START:$,DARK_START:tt,MIDDLE_FOUR_RANK_TWO_FILE:ot,MIDDLE_TWO_RANK_FOUR_FILE:st};class _{constructor(t){l(this,"forward");l(this,"backward");l(this,"opponent");l(this,"empty");this.forward=t.forward,this.backward=t.backward,this.opponent=t.opponent,this.empty=t.empty}static fromPlayerAndBoard(t,o){const n=t===u.DraughtsPlayer.LIGHT?o.light:o.dark&o.king,e=t===u.DraughtsPlayer.LIGHT?o.light&o.king:o.dark,a=t===u.DraughtsPlayer.LIGHT?o.dark:o.light,c=~(o.light|o.dark);return new _({forward:n,backward:e,opponent:a,empty:c})}getJumpers(){let t=d(this.empty,7)&(this.opponent&i.FORWARD_LEFT),o=d(t,7)&(this.forward&i.FORWARD_LEFT);return t=d(this.empty,1)&(this.opponent&i.FORWARD_RIGHT),o|=d(t,1)&(this.forward&i.FORWARD_RIGHT),t=h(this.empty,1)&(this.opponent&i.BACKWARD_LEFT),o|=h(t,1)&(this.backward&i.BACKWARD_LEFT),t=h(this.empty,7)&(this.opponent&i.BACKWARD_RIGHT),o|=h(t,7)&(this.backward&i.BACKWARD_RIGHT),o}getMovers(){let t=0;return this.forward&&(t|=d(this.empty,7)&this.forward&i.FORWARD_LEFT,t|=d(this.empty,1)&this.forward&i.FORWARD_RIGHT),this.backward&&(t|=h(this.empty,1)&this.backward&i.BACKWARD_LEFT,t|=h(this.empty,7)&this.backward&i.BACKWARD_RIGHT),t}getMovesFromOrigin(t){const o=[];if(t&this.forward){const n=(h(t&i.FORWARD_LEFT,7)&this.empty)>>>0;n&&o.push({origin:t,destination:n,captures:0});const e=(h(t&i.FORWARD_RIGHT,1)&this.empty)>>>0;e&&o.push({origin:t,destination:e,captures:0})}if(t&this.backward){const n=d(t&i.BACKWARD_LEFT,1)&this.empty;n&&o.push({origin:t,destination:n,captures:0});const e=d(t&i.BACKWARD_RIGHT,7)&this.empty;e&&o.push({origin:t,destination:e,captures:0})}return o}getJumpsFromOrigin(t){const o=this.getSingleJumpFromOrigin(t),n=[];for(;o.length>0;){const e=o.pop();if(e===void 0)break;const c=this._fromMove({...e,origin:t}).getSingleJumpFromOrigin(e.destination);for(const p of c)o.push({origin:t,destination:p.destination,captures:e.captures|p.captures});c.length===0&&n.push(e)}return n}getSingleJumpFromOrigin(t){const o=[];if(t&this.forward){const n=h(t&i.FORWARD_LEFT,7)&this.opponent,e=(h(n&i.FORWARD_LEFT,7)&this.empty)>>>0;e&&o.push({origin:t,destination:e,captures:n});const a=h(t&i.FORWARD_RIGHT,1)&this.opponent,c=(h(a&i.FORWARD_RIGHT,1)&this.empty)>>>0;c&&o.push({origin:t,destination:c,captures:a})}if(t&this.backward){const n=d(t&i.BACKWARD_LEFT,1)&this.opponent,e=d(n&i.BACKWARD_LEFT,1)&this.empty;e&&o.push({origin:t,destination:e,captures:n});const a=d(t&i.BACKWARD_RIGHT,7)&this.opponent,c=d(a&i.BACKWARD_RIGHT,7)&this.empty;c&&o.push({origin:t,destination:c,captures:a})}return o}_fromMove(t){return new _({forward:this.forward&t.origin?this.forward|t.destination:this.forward,backward:this.backward&t.origin?this.backward|t.destination:this.backward,opponent:this.opponent&~t.captures,empty:this.empty})}}const rt={player:u.DraughtsPlayer.DARK,board:{light:i.LIGHT_START,dark:i.DARK_START,king:0},store:{sinceCapture:0,sinceNonKingAdvance:0}},nt={serializeStore(s){return{...s}},status(s){return s.moves.length===0?s.data.player===u.DraughtsPlayer.LIGHT?u.DraughtsStatus.DARK_WON:u.DraughtsStatus.LIGHT_WON:s.data.store.sinceCapture>=40&&s.data.store.sinceNonKingAdvance>=40?u.DraughtsStatus.DRAW:u.DraughtsStatus.PLAYING},isValidMove(s,t){return s.moves.some(o=>V(t,o))},moves(s){const t=_.fromPlayerAndBoard(s.data.player,s.data.board),o=[],n=t.getJumpers();if(n){for(const a of y(n))o.push(...t.getJumpsFromOrigin(a));return o}const e=t.getMovers();for(const a of y(e))o.push(...t.getMovesFromOrigin(a));return o},move(s,t){if(!s.isValidMove(t))throw new Error(`invalid move: ${JSON.stringify(t)}`);const o={...s.data.board},n={...s.data.store};return o.light&=~(t.origin|t.captures),o.dark&=~(t.origin|t.captures),o.king&=~(t.origin|t.captures),s.data.board.light&t.origin?(o.light|=t.destination,o.king|=t.destination&i.RANK_7):(o.dark|=t.destination,o.king|=t.destination&i.RANK_0),s.data.board.king&t.origin?(o.king|=t.destination,n.sinceNonKingAdvance+=1):n.sinceNonKingAdvance=0,t.captures?n.sinceCapture=0:n.sinceCapture+=1,{player:s.data.player===u.DraughtsPlayer.LIGHT?u.DraughtsPlayer.DARK:u.DraughtsPlayer.LIGHT,board:o,store:n}}},O={setup(s){return new u.DraughtsEngine({...rt,...s},nt)}},R=[r[11],r[5],r[31],r[25],r[10],r[4],r[30],r[24],r[3],r[29],r[23],r[17],r[2],r[28],r[22],r[16],r[27],r[21],r[15],r[9],r[26],r[20],r[14],r[8],r[19],r[13],r[7],r[1],r[18],r[12],r[6],r[0]],I=new Map(R.map((s,t)=>[s,t])),E={toMove1D(s){const t=I.get(s.origin);if(t===void 0)throw new Error(`invalid move origin: ${s.origin}`);const o=I.get(s.destination);if(o===void 0)throw new Error(`invalid move destination: ${s.destination}`);const n=[];for(const e of y(s.captures)){const a=I.get(e);a!==void 0&&n.push(a)}return{origin:t,destination:o,captures:n}},toEngineMove(s){const t=R[s.origin];if(t===void 0)throw new Error(`invalid move origin: ${s.origin}`);const o=R[s.destination];if(o===void 0)throw new Error(`invalid move destination: ${s.destination}`);let n=0;for(const e of s.captures){const a=R[e];if(a===void 0)throw new Error(`invalid move capture: ${e}`);n|=a}return{origin:t,destination:o,captures:n}},toBoard1D(s){const t=[];for(const[o,n]of R.entries()){Math.floor(o/4)%2===0&&t.push({dark:!1,piece:void 0,position:void 0});const e=!!(n&s.light),a=!!(n&s.dark),c=!!(n&s.king);t.push({dark:!0,position:o,piece:e||a?{player:e?u.DraughtsPlayer.LIGHT:u.DraughtsPlayer.DARK,king:c}:void 0}),Math.floor(o/4)%2!==0&&t.push({dark:!1,piece:void 0,position:void 0})}return t}},et={moves:[],boards:[]},at={setup(s,t){const o=O.setup(s);return new q(o,{...et,...t},E)}},w={setup({adapter:s,strategy:t,options:o}){return async n=>{const e=await t({options:o,engine:n.engine});return s.toMove1D(e)}}};async function it({options:{maxDepth:s,evaluationFunction:t,quiescence:o=!0},engine:n}){let e=Number.NEGATIVE_INFINITY,a;for(const c of n.moves){const p=n.clone();p.move(c);const f=-await W({data:{engine:p,alpha:Number.NEGATIVE_INFINITY,beta:Number.POSITIVE_INFINITY,depth:s-1},options:{evaluationFunction:t,quiescence:o}});f>=e&&(e=f,a=c)}if(a===void 0)throw new Error("no available moves");return a}async function W({data:{engine:s,alpha:t,beta:o,depth:n},options:{evaluationFunction:e,quiescence:a}}){if(n===0)return a?G({data:{engine:s,alpha:t,beta:o},options:{evaluationFunction:e}}):e(s);for(const c of s.moves){const p=s.clone();p.move(c);const f=-await W({data:{engine:p,alpha:-o,beta:-t,depth:n-1},options:{evaluationFunction:e,quiescence:a}});if(f>=o)return o;t=Math.max(f,t)}return t}async function G({data:{engine:s,alpha:t,beta:o},options:{evaluationFunction:n}}){const e=n(s);if(e>=o)return o;t=Math.max(e,t);for(const a of s.moves){if(!a.captures)continue;const c=s.clone();c.move(a);const p=-await G({data:{engine:c,alpha:-o,beta:-t},options:{evaluationFunction:n}});if(p>=o)return o;t=Math.max(p,t)}return t}async function ct({engine:s}){if(s.moves.length===0)throw new Error("no valid moves");const t=Math.floor(Math.random()*s.moves.length);return s.moves[t]}const ut={[u.DraughtsStatus.LIGHT_WON]:u.DraughtsPlayer.LIGHT,[u.DraughtsStatus.DARK_WON]:u.DraughtsPlayer.DARK},pt=s=>{const t=s.status;return t!==u.DraughtsStatus.PLAYING?t===u.DraughtsStatus.DRAW?Number.NEGATIVE_INFINITY:s.data.player===ut[t]?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Rt(s)},dt=50,ht=77,lt=40,gt=25,ft=5;function Rt(s){const t=s.data.player===u.DraughtsPlayer.LIGHT?s.data.board.light:s.data.board.dark,o=s.data.player===u.DraughtsPlayer.LIGHT?s.data.board.dark:s.data.board.light,n=t&s.data.board.king,e=o&s.data.board.king,a=s.data.player===u.DraughtsPlayer.LIGHT?i.RANK_0:i.RANK_7,c=s.data.player===u.DraughtsPlayer.LIGHT?i.RANK_7:i.RANK_0,p=g(t),f=g(o),M=g(n),H=g(e),b=g(t&a),S=g(o&c),C=g(t&i.MIDDLE_TWO_RANK_FOUR_FILE),P=g(o&i.MIDDLE_TWO_RANK_FOUR_FILE),B=g(t&i.MIDDLE_FOUR_RANK_TWO_FILE),x=g(o&i.MIDDLE_FOUR_RANK_TWO_FILE);return(p-f)*dt+(M-H)*ht+(b-S)*lt+(C-P)*gt+(B-x)*ft}const Dt={random(){return w.setup({adapter:E,strategy:ct,options:void 0})},alphaBeta(s){const t={maxDepth:s.maxDepth??4,quiescence:s.quiescence??!0,evaluationFunction:s.evaluationFunction??pt};return w.setup({adapter:E,strategy:it,options:t})}};exports.EnglishDraughts=at;exports.EnglishDraughtsBitSquare=r;exports.EnglishDraughtsComputerFactory=Dt;exports.EnglishDraughtsEngineFactory=O;
//# sourceMappingURL=english.cjs.map
