{"version":3,"file":"engine-eb68f1f2.js","sources":["../src/core/engine.ts"],"sourcesContent":["import Long from 'long';\n\nexport enum DraughtsStatus {\n  PLAYING = 'playing',\n  DRAW = 'draw',\n  LIGHT_WON = 'light_won',\n  DARK_WON = 'dark_won',\n}\n\nexport type Bitboard = number | Long;\n\nexport type DraughtsEngineBoard<T extends Bitboard> = {\n  readonly light: T;\n  readonly dark: T;\n  readonly king: T;\n};\n\nexport type DraughtsEngineMove<T extends Bitboard> = {\n  readonly origin: T;\n  readonly destination: T;\n  readonly captures: T;\n};\n\nexport enum DraughtsPlayer {\n  LIGHT = 'light',\n  DARK = 'dark',\n}\n\nexport type DraughtsEngineData<T extends Bitboard, E> = {\n  player: DraughtsPlayer;\n  board: DraughtsEngineBoard<T>;\n  store: E;\n};\n\nexport type DraughtsEngineStrategy<T extends Bitboard, E> = {\n  moves: (engine: DraughtsEngine<T, E>) => DraughtsEngineMove<T>[];\n  status: (engine: DraughtsEngine<T, E>) => DraughtsStatus;\n  isValidMove: (\n    engine: DraughtsEngine<T, E>,\n    move: DraughtsEngineMove<T>\n  ) => boolean;\n  move: (\n    engine: DraughtsEngine<T, E>,\n    move: DraughtsEngineMove<T>\n  ) => DraughtsEngineData<T, E>;\n  serializeStore: (store: E) => E;\n};\n\nexport class DraughtsEngine<T extends Bitboard, E> {\n  data: DraughtsEngineData<T, E>;\n\n  private strategy: DraughtsEngineStrategy<T, E>;\n\n  private _moves: DraughtsEngineMove<T>[] | undefined;\n  private _status: DraughtsStatus | undefined;\n\n  constructor(\n    data: DraughtsEngineData<T, E>,\n    strategy: DraughtsEngineStrategy<T, E>\n  ) {\n    this.data = data;\n    this.strategy = strategy;\n  }\n\n  /**\n   * Returns the current game status\n   */\n  get status(): DraughtsStatus {\n    return (this._status ??= this.strategy.status(this));\n  }\n\n  /**\n   * Returns the available moves\n   */\n  get moves(): DraughtsEngineMove<T>[] {\n    return (this._moves ??= this.strategy.moves(this));\n  }\n\n  /**\n   * Clones the current engine instance\n   * @returns A new cloned engine instance\n   */\n  clone(): DraughtsEngine<T, E> {\n    return new DraughtsEngine(this.serialize(), this.strategy);\n  }\n\n  /**\n   * Serializes the engine data\n   * @returns The serialized engine data\n   */\n  serialize(): DraughtsEngineData<T, E> {\n    return {\n      board: { ...this.data.board },\n      store: this.strategy.serializeStore(this.data.store),\n      player: this.data.player,\n    };\n  }\n\n  move(move: DraughtsEngineMove<T>): void {\n    this.data = this.strategy.move(this, move);\n    this._moves = undefined;\n    this._status = undefined;\n  }\n\n  isValidMove(move: DraughtsEngineMove<T>): boolean {\n    return this.strategy.isValidMove(this, move);\n  }\n}\n"],"names":["DraughtsStatus","DraughtsPlayer","DraughtsEngine","data","strategy","__publicField","move"],"mappings":";;;AAEY,IAAAA,sBAAAA,OACVA,EAAA,UAAU,WACVA,EAAA,OAAO,QACPA,EAAA,YAAY,aACZA,EAAA,WAAW,YAJDA,IAAAA,KAAA,CAAA,CAAA,GAqBAC,sBAAAA,OACVA,EAAA,QAAQ,SACRA,EAAA,OAAO,QAFGA,IAAAA,KAAA,CAAA,CAAA;AAyBL,MAAMC,EAAsC;AAAA,EAQjD,YACEC,GACAC,GACA;AAVF,IAAAC,EAAA;AAEQ,IAAAA,EAAA;AAEA,IAAAA,EAAA;AACA,IAAAA,EAAA;AAMN,SAAK,OAAOF,GACZ,KAAK,WAAWC;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,SAAyB;AAC3B,WAAQ,KAAK,YAAL,KAAK,UAAY,KAAK,SAAS,OAAO,IAAI;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,QAAiC;AACnC,WAAQ,KAAK,WAAL,KAAK,SAAW,KAAK,SAAS,MAAM,IAAI;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,QAA8B;AAC5B,WAAO,IAAIF,EAAe,KAAK,UAAU,GAAG,KAAK,QAAQ;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,YAAsC;AAC7B,WAAA;AAAA,MACL,OAAO,EAAE,GAAG,KAAK,KAAK,MAAM;AAAA,MAC5B,OAAO,KAAK,SAAS,eAAe,KAAK,KAAK,KAAK;AAAA,MACnD,QAAQ,KAAK,KAAK;AAAA,IAAA;AAAA,EAEtB;AAAA,EAEA,KAAKI,GAAmC;AACtC,SAAK,OAAO,KAAK,SAAS,KAAK,MAAMA,CAAI,GACzC,KAAK,SAAS,QACd,KAAK,UAAU;AAAA,EACjB;AAAA,EAEA,YAAYA,GAAsC;AAChD,WAAO,KAAK,SAAS,YAAY,MAAMA,CAAI;AAAA,EAC7C;AACF;"}